# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–∏—Å–∞–Ω–∏—è –¥–µ–Ω–µ–≥ —Å–æ —Å–º–µ–Ω—ã

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–∏—Å–∞–Ω–∏—è –∏ —Å–Ω—è—Ç–∏—è –¥–µ–Ω–µ–≥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Club Assistant.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 1. **deductions_summary.txt** (–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê)
–ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–æ –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫.
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–ø–∏—Å–∞–Ω–∏—è
- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –≤ –∫–æ–¥–µ
- –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- –¢–∞–±–ª–∏—Ü—ã –ë–î

### 2. **deductions_report.md** (–î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó)
–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ SQL –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
- –§—É–Ω–∫—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –ö–Ω–æ–ø–∫–∏ –∏ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ë–î
- –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
- –ü—Ä–æ—Ü–µ—Å—Å—ã –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–ø–∏—Å–∞–Ω–∏—è—Ö

### 3. **DEDUCTIONS_CODE_EXAMPLES.md** (–ü–†–ò–ú–ï–†–´ –ö–û–î–ê)
–ü–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
- Process expense flow - —Å –ø–æ–ª–Ω—ã–º –∫–æ–¥–æ–º —Ñ—É–Ω–∫—Ü–∏–π
- Process withdrawal flow - —Å –ø–æ–ª–Ω—ã–º –∫–æ–¥–æ–º —Ñ—É–Ω–∫—Ü–∏–π
- –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ –±–æ—Ç–µ

### 4. **DEDUCTIONS_FLOW_DIAGRAM.txt** (–î–ò–ê–ì–†–ê–ú–ú–´)
–í–∏–∑—É–∞–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
- –ü—Ä–æ—Ü–µ—Å—Å —Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (EXPENSE)
- –ü—Ä–æ—Ü–µ—Å—Å —Å–Ω—è—Ç–∏—è –Ω–∞–ª–∏—á–Ω—ã—Ö (WITHDRAWAL)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –ë–î
- Callback –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## –ë—ã—Å—Ç—Ä—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### –î–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è:

#### 1. –°–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ (EXPENSE)
- **–ó–∞–ø—É—Å–∫:** –ö–Ω–æ–ø–∫–∞ "üí∏ –°–ø–∏—Å–∞—Ç—å —Å –∫–∞—Å—Å—ã"
- **–§—É–Ω–∫—Ü–∏—è:** `cmd_expense()` [—Å—Ç—Ä–æ–∫–∞ 1743]
- **–¢–∞–±–ª–∏—Ü–∞:** `shift_expenses`
- **–®–∞–≥–∏:** –≤—ã–±–æ—Ä –∫–∞—Å—Å—ã ‚Üí —Å—É–º–º–∞ ‚Üí –ø—Ä–∏—á–∏–Ω–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

#### 2. –°–Ω—è—Ç–∏–µ –Ω–∞–ª–∏—á–Ω—ã—Ö (WITHDRAWAL)
- **–ó–∞–ø—É—Å–∫:** –ö–Ω–æ–ø–∫–∞ "üí∞ –í–∑—è—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É"
- **–§—É–Ω–∫—Ü–∏—è:** `start_cash_withdrawal()` [—Å—Ç—Ä–æ–∫–∞ 2428]
- **–¢–∞–±–ª–∏—Ü–∞:** `shift_cash_withdrawals`
- **–®–∞–≥–∏:** —Å—É–º–º–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ú–æ–¥—É–ª–∏
- `modules/finmon_shift_wizard.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Å –¥–∏–∞–ª–æ–≥–∞–º–∏
- `modules/shift_manager.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–∞–º–∏ –∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏
- `modules/salary_calculator.py` - –∑–∞–ø–∏—Å—å —Å–Ω—è—Ç–∏–π –∏ —Ä–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã
- `bot.py` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Telegram

### –¢–∞–±–ª–∏—Ü—ã –ë–î
- `shift_expenses` - —Ä–∞—Å—Ö–æ–¥—ã —Å–æ —Å–º–µ–Ω—ã (–æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Å—Å–∞/–∫–æ—Ä–æ–±–∫–∞)
- `shift_cash_withdrawals` - —Å–Ω—è—Ç–∏—è –Ω–∞–ª–∏—á–Ω—ã—Ö –¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç—ã
- `active_shifts` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–º–µ–Ω—ã (—Å–≤—è–∑–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

### –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
- **–†–∞—Å—Ö–æ–¥—ã:** 14-17 (SELECT_SOURCE ‚Üí AMOUNT ‚Üí REASON ‚Üí CONFIRM)
- **–°–Ω—è—Ç–∏—è:** 18-19 (AMOUNT ‚Üí CONFIRM)

---

## –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î

### –î–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤
```
ShiftManager.add_expense(shift_id, cash_source, amount, reason) ‚Üí bool
```
–í—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `shift_expenses`

### –î–ª—è —Å–Ω—è—Ç–∏–π
```
SalaryCalculator.record_cash_withdrawal(shift_id, admin_id, amount, reason='salary') ‚Üí int
```
–í—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `shift_cash_withdrawals`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –∑–∞–ø–∏—Å–∏

---

## –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–ø–∏—Å–∞–Ω–∏—è—Ö

```
ShiftManager.get_shift_expenses(shift_id) ‚Üí List[Dict]
ShiftManager.get_expenses_summary(shift_id) ‚Üí Dict[str, float]
SalaryCalculator.get_cash_withdrawals(admin_id, start_date, end_date) ‚Üí float
```

---

## Callback –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –î–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤
- `shift_expense` - –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞
- `expense_main` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Å—Å–∞
- `expense_box` - –∫–æ—Ä–æ–±–∫–∞
- `expense_confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `expense_cancel` - –æ—Ç–º–µ–Ω–∞

### –î–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ª–∏—á–Ω—ã—Ö
- `shift_salary` - –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞
- `withdrawal_confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `withdrawal_cancel` - –æ—Ç–º–µ–Ω–∞

---

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
–í–ª–∞–¥–µ–ª—å—Ü—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
- –ù–æ–º–µ—Ä —Å–º–µ–Ω—ã
- –ö–ª—É–±
- –ö–∞—Å—Å–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è/–∫–æ—Ä–æ–±–∫–∞)
- –°—É–º–º–∞
- –ü—Ä–∏—á–∏–Ω–∞
- –§–ò –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ü—Ä–∏ —Å–Ω—è—Ç–∏–∏ –Ω–∞–ª–∏—á–Ω—ã—Ö
–í–ª–∞–¥–µ–ª—å—Ü—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
- –§–ò –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ ID
- –ö–ª—É–±
- –ù–æ–º–µ—Ä —Å–º–µ–Ω—ã
- –°—É–º–º–∞
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

---

## –í–∞–ª–∏–¥–∞—Ü–∏—è

### –°—É–º–º–∞
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∑–∞–ø—è—Ç—ã–µ –∏ –ø—Ä–æ–±–µ–ª—ã)
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0
- –û—à–∏–±–∫–∞: "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç" –∏–ª–∏ "‚ùå –°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"

### –ü—Ä–∏—á–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤)
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
- –û—à–∏–±–∫–∞: "‚ùå –ü—Ä–∏—á–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤"

### –°–º–µ–Ω–∞
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ–π (status='open')
- –û—à–∏–±–∫–∞: "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã" –∏–ª–∏ "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã"

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

1. **–ù–∞—á–Ω–∏—Ç–µ —Å `deductions_summary.txt`** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–∑–æ—Ä–∞
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `deductions_report.md`** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `DEDUCTIONS_CODE_EXAMPLES.md`** —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–¥
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DEDUCTIONS_FLOW_DIAGRAM.txt`** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞

---

## –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –≤ –∫–æ–¥–µ

### finmon_shift_wizard.py (–æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å)
- –°—Ç—Ä–æ–∫–∞ 61: –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞
- –°—Ç—Ä–æ–∫–∞ 1727: start_expense()
- –°—Ç—Ä–æ–∫–∞ 1743: cmd_expense()
- –°—Ç—Ä–æ–∫–∞ 1785: expense_select_cash_source()
- –°—Ç—Ä–æ–∫–∞ 1817: expense_receive_amount()
- –°—Ç—Ä–æ–∫–∞ 1849: expense_receive_reason()
- –°—Ç—Ä–æ–∫–∞ 1883: expense_confirm()
- –°—Ç—Ä–æ–∫–∞ 2428: start_cash_withdrawal()
- –°—Ç—Ä–æ–∫–∞ 2470: receive_withdrawal_amount()
- –°—Ç—Ä–æ–∫–∞ 2518: handle_withdrawal_confirmation()

### shift_manager.py
- –°—Ç—Ä–æ–∫–∞ 186: add_expense()
- –°—Ç—Ä–æ–∫–∞ 218: get_shift_expenses()
- –°—Ç—Ä–æ–∫–∞ 249: get_expenses_summary()

### salary_calculator.py
- –°—Ç—Ä–æ–∫–∞ 123: get_cash_withdrawals()
- –°—Ç—Ä–æ–∫–∞ 384: record_cash_withdrawal()

### bot.py
- –°—Ç—Ä–æ–∫–∞ 2237: –ö–Ω–æ–ø–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
- –°—Ç—Ä–æ–∫–∏ 4770-4792: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è expense_handler
- –°—Ç—Ä–æ–∫–∏ 4794-4813: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è withdrawal_handler

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-08  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
