# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ Club Assistant Bot

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã
- **–Ø–∑—ã–∫ –æ–±—â–µ–Ω–∏—è**: –≤—Å–µ–≥–¥–∞ —Ä—É—Å—Å–∫–∏–π
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ**: —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –Ω–∞ —Ä—É—Å—Å–∫–æ–º

## –ö–ª—é—á–µ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã

### –í–ª–∞–¥–µ–ª–µ—Ü
- **ID**: 1811673966
- **–ü—Ä–∞–≤–∞**: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º

### –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π
- **ID**: 7919727683
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–∫—Ä—ã—Ç–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω

### –ö–ª—É–±–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
–≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã Telegram, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—É–±–∞–º:

- **–†–∏–æ**: ID `5329834944`
- **–°–µ–≤–µ—Ä**: ID `5992731922`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–ª—É–±–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:**
1. –ò–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–Ω–æ–ø–∫–µ "üîì –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É"
2. –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏" –∏ "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∫–ª—É–±–∞" **–¢–û–õ–¨–ö–û –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω–µ**
3. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–ø—Ä–∏–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∞–¥–º–∏–Ω—É, –æ—Ç–∫—Ä—ã–≤—à–µ–º—É —Å–º–µ–Ω—É**

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.json
```json
{
  "owner_id": 1811673966,           // –í–ª–∞–¥–µ–ª–µ—Ü
  "controller_id": 7919727683,      // –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–π
  "club_accounts": {                // –ö–ª—É–±–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
    "rio": 5329834944,
    "sever": 5992731922
  }
}
```

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª—É–±–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã

1. **finmon_simple.py** ([—Å—Ç—Ä–æ–∫–∞ 23-26](modules/finmon_simple.py#L23-L26))
   ```python
   CHAT_TO_CLUB = {
       5329834944: "–†–∏–æ",
       5992731922: "–°–µ–≤–µ—Ä"
   }
   ```

2. **finmon_001_init.sql** ([—Å—Ç—Ä–æ–∫–∞ 101-105](migrations/finmon_001_init.sql#L101-L105))
   ```sql
   INSERT INTO chat_club_mapping (chat_id, club_id) VALUES
       (5329834944, 1),  -- –†–∏–æ
       (5992731922, 2);  -- –°–µ–≤–µ—Ä
   ```

3. **product_commands.py** ([—Å—Ç—Ä–æ–∫–∞ 23-28](product_commands.py#L23-L28))
   - –ü–æ–ª—É—á–∞–µ—Ç club_account_id –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
   - –ú–µ—Ç–æ–¥ `get_actual_user_id()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
   - –ú–µ—Ç–æ–¥ `can_use_products()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã

## –°–∏—Å—Ç–µ–º–∞ —Å–º–µ–Ω

### –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã
- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∫–ª—É–±–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–∞–º
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–º—É (7919727683)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `active_shifts`

### –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã
- –î–æ—Å—Ç—É–ø–Ω–æ –∞–¥–º–∏–Ω–∞–º, –æ—Ç–∫—Ä—ã–≤—à–∏–º —Å–º–µ–Ω—É
- **–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏:**
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–º–µ–Ω—ã
  - –ö–Ω–æ–ø–∫–∏ "–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π" –¥–ª—è –≤—Å–µ—Ö –∫–∞—Å—Å
  - –ö–Ω–æ–ø–∫–∏ "‚ùå –ö–∞—Å—Å–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞" –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–∞—Å—Å
  - –ó–∞–≥—Ä—É–∑–∫–∞ 4 Z-–æ—Ç—á–µ—Ç–æ–≤ —Å —Ñ–æ—Ç–æ (–Ω–∞–ª–∏—á–∫–∞, –∫–∞—Ä—Ç–∞, QR, –∫–∞—Ä—Ç–∞2)
  - OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ OpenAI Vision API
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É `finmon_shifts`
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–≥–æ —Å —Ñ–æ—Ç–æ –∏ –¥–∞–Ω–Ω—ã–º–∏

### –ü—Ä–∏–≤—è–∑–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∫ —Å–º–µ–Ω–µ
–ö–æ–≥–¥–∞ –∫–ª—É–±–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω–µ:
- **–¢–æ–≤–∞—Ä—ã**: –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –∞–¥–º–∏–Ω–∞, –æ—Ç–∫—Ä—ã–≤—à–µ–≥–æ —Å–º–µ–Ω—É
- **–ü—Ä–æ–±–ª–µ–º—ã**: —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∞ —Å–º–µ–Ω—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑:
- `ProductCommands.get_actual_user_id()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `ShiftManager.get_all_active_shifts()` - –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–º–µ–Ω

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `admins` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∫–ª—É–±–∞
- `active_shifts` - –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–º–µ–Ω—ã
- `finmon_shifts` - –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–º–µ–Ω—ã —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `chat_club_mapping` - –ø—Ä–∏–≤—è–∑–∫–∞ chat_id –∫ –∫–ª—É–±–∞–º
- `club_issues` - –ø—Ä–æ–±–ª–µ–º—ã –∫–ª—É–±–æ–≤
- `admin_products` - —Ç–æ–≤–∞—Ä—ã –∞–¥–º–∏–Ω–æ–≤

### –§–∞–π–ª—ã
- `club_assistant.db` - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ SQLite
- `finmon_balances.json` - –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ –∫–ª—É–±–∞–º
- `finmon_log.csv` - –ª–æ–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## –ú–æ–¥—É–ª–∏

### –°–º–µ–Ω—ã
- `modules/finmon_shift_wizard.py` - –º–∞—Å—Ç–µ—Ä –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω
- `modules/finmon_shift_improvements.py` - —É–ª—É—á—à–µ–Ω–∏—è (OCR, –æ—Å—Ç–∞—Ç–∫–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- `modules/shift_manager.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–º–µ–Ω–∞–º–∏

### –¢–æ–≤–∞—Ä—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã
- `product_commands.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏
- `issue_commands.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
- `product_manager.py` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤

### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- `modules/finmon_simple.py` - –ø—Ä–æ—Å—Ç–æ–π —Ñ–∏–Ω–º–æ–Ω –±–µ–∑ –ë–î
- `modules/finmon_schedule.py` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–º–µ–Ω –∏–∑ Google Sheets
- `modules/finmon_analytics.py` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## WebApp
- **URL**: https://tmbclz.ru/
- **–°–µ—Ä–≤–µ—Ä**: `/opt/club_assistant/webapp/server.py` (Flask)
- **SSL**: Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- **Nginx**: `/etc/nginx/sites-available/webapp`
- **–î–∞–Ω–Ω—ã–µ**: –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `finmon_shifts`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### OpenAI
- **–ú–æ–¥–µ–ª—å**: gpt-4o-mini
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
  - RAG –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
  - OCR Z-–æ—Ç—á–µ—Ç–æ–≤ (~$0.01-0.02 –∑–∞ —Ñ–æ—Ç–æ)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (DALL-E)

### Google Sheets
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã 19ILASe6UH7-j1okxg9mvz_GrkQAkCJLXA1mxwocLcV8
- **Credentials**: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `GOOGLE_SA_JSON`

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –í–ª–∞–¥–µ–ª–µ—Ü (1811673966)
- üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- üîê V2Ray VPN
- üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–≥—Ä–∞—Ñ–∏–∫–∏)

### –í—Å–µ –∞–¥–º–∏–Ω—ã
- üîì –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É / üîí –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É
- üí∏ –°–ø–∏—Å–∞—Ç—å —Å –∫–∞—Å—Å—ã
- üí∞ –í–∑—è—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É
- üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∫–ª—É–±–∞
- üìä `/shiftstatus` - —Å—Ç–∞—Ç—É—Å —Å–º–µ–Ω –∏ –æ—Å—Ç–∞—Ç–∫–∏ –≤ –∫–∞—Å—Å–∞—Ö

### –ö–ª—É–±–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã (–ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω–µ)
- üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ (–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∞–¥–º–∏–Ω–∞ —Å–º–µ–Ω—ã)
- ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∫–ª—É–±–∞ (–æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∞ —Å–º–µ–Ω—ã)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –∫–ª—É–±–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:**
- `product_commands.py` - –º–µ—Ç–æ–¥ `get_actual_user_id()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
- `product_commands.py` - –º–µ—Ç–æ–¥ `can_use_products()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- `issue_commands.py` - –º–µ—Ç–æ–¥ `get_actual_user_id()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
- `issue_commands.py` - –º–µ—Ç–æ–¥ `can_use_issues()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

## –ê–≤—Ç–æ–∑–∞–¥–∞—á–∏

### –û—á–∏—Å—Ç–∫–∞ —Ä–µ—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- **–ü–µ—Ä–∏–æ–¥**: 14 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `issue_manager.cleanup_old_resolved_issues()`
- **–ó–∞–ø—É—Å–∫**: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –º–∏–≥—Ä–∞—Ü–∏–π –∏–∑ –ø–∞–ø–∫–∏ `migrations/`:
- `finmon_001_init.sql` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–º–æ–Ω–∞
- `create_finmon_shifts.sql` - —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω

## Deployment

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ systemd —Å–µ—Ä–≤–∏—Å:
```bash
sudo systemctl status club_assistant
sudo systemctl restart club_assistant
sudo journalctl -u club_assistant -f
```

**–ü—É—Ç—å**: `/opt/club_assistant/`
**–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**: `/opt/club_assistant/venv/`
