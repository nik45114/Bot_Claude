–î–ò–ê–ì–†–ê–ú–ú–ê –ü–û–¢–û–ö–ê –°–ü–ò–°–ê–ù–ò–Ø –î–ï–ù–ï–ì –°–û –°–ú–ï–ù–´
========================================

1. –ü–†–û–¶–ï–°–° –°–ü–ò–°–ê–ù–ò–Ø –†–ê–°–•–û–î–û–í (EXPENSE FLOW)
===========================================

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç:
  üí∏ "–°–ø–∏—Å–∞—Ç—å —Å –∫–∞—Å—Å—ã" (callback_data="shift_expense")
           |
           v
    start_expense() [—Å—Ç—Ä–æ–∫–∞ 1727]
      (–ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç callback –≤ message)
           |
           v
    cmd_expense() [—Å—Ç—Ä–æ–∫–∞ 1743]
      - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã
      - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç expense_shift_id –∏ expense_club –≤ context
      - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–∞—Å—Å—ã
           |
           +-> –ï—Å–ª–∏ –Ω–µ—Ç —Å–º–µ–Ω—ã: ‚ùå "–£ –≤–∞—Å –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã"
           |
           +-> –ï—Å–ª–∏ –µ—Å—Ç—å —Å–º–µ–Ω–∞:
                    |
                    v
          –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (EXPENSE_SELECT_CASH_SOURCE = 14)
              –ö–Ω–æ–ø–∫–∏: üí∞ –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Å—Å–∞ / üì¶ –ö–æ—Ä–æ–±–∫–∞
                    |
                    v
    expense_select_cash_source() [—Å—Ç—Ä–æ–∫–∞ 1785]
      - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–±–æ—Ä (expense_main –∏–ª–∏ expense_box)
      - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç expense_cash_source –∏ expense_source_label
      - –ü—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ —Å—É–º–º—É
                    |
                    v
          –í–≤–æ–¥ —Å—É–º–º—ã (EXPENSE_ENTER_AMOUNT = 15)
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —á–∏—Å–ª–æ
                    |
                    v
    expense_receive_amount() [—Å—Ç—Ä–æ–∫–∞ 1817]
      - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç: —Å—É–º–º–∞ > 0
      - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç expense_amount –≤ context
      - –ü—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –ø—Ä–∏—á–∏–Ω—É
                    |
                    +-> –ï—Å–ª–∏ —Å—É–º–º–∞ <= 0: ‚ùå "–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"
                    |
                    +-> –ï—Å–ª–∏ —Å—É–º–º–∞ > 0:
                             |
                             v
          –í–≤–æ–¥ –ø—Ä–∏—á–∏–Ω—ã (EXPENSE_ENTER_REASON = 16)
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç (1-200 —Å–∏–º–≤–æ–ª–æ–≤)
                             |
                             v
    expense_receive_reason() [—Å—Ç—Ä–æ–∫–∞ 1849]
      - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç: 1 <= len(reason) <= 200
      - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç expense_reason –≤ context
      - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
                             |
                             +-> –ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –ø—É—Å—Ç–∞—è/–¥–ª–∏–Ω–Ω–∞—è: ‚ùå "–ü—Ä–∏—á–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤"
                             |
                             +-> –ï—Å–ª–∏ –ø—Ä–∏—á–∏–Ω–∞ –≤–∞–ª–∏–¥–Ω–∞:
                                      |
                                      v
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (EXPENSE_CONFIRM = 17)
          –ö–Ω–æ–ø–∫–∏: ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å / ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                                      |
                                      v
    expense_confirm() [—Å—Ç—Ä–æ–∫–∞ 1883]
      
      –ï—Å–ª–∏ "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å":
         |
         v
      ShiftManager.add_expense() [—Å—Ç—Ä–æ–∫–∞ 186 - shift_manager.py]
         |
         v
      INSERT INTO shift_expenses (shift_id, cash_source, amount, reason)
         |
         v
      ‚úÖ "–°–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!" 
         |
         v
      –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –í–õ–ê–î–ï–õ–¨–¶–£:
         üí∏ –°–ø–∏—Å–∞–Ω–∏–µ –≤ —Å–º–µ–Ω–µ #{shift_id}
         üè¢ {club} | {source_label}
         üí∞ {amount} ‚ÇΩ
         üìù {reason}
         üë§ {admin_name}
         |
         v
      –ö–æ–Ω–µ—Ü –¥–∏–∞–ª–æ–≥–∞ (ConversationHandler.END)
      
      –ï—Å–ª–∏ "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å":
         |
         v
      ‚ùå "–°–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ"
      –ö–æ–Ω–µ—Ü –¥–∏–∞–ª–æ–≥–∞


2. –ü–†–û–¶–ï–°–° –°–ù–Ø–¢–ò–Ø –ù–ê–õ–ò–ß–ù–´–• (WITHDRAWAL FLOW)
============================================

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç:
  üí∞ "–í–∑—è—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É" (callback_data="shift_salary")
           |
           v
    start_cash_withdrawal() [—Å—Ç—Ä–æ–∫–∞ 2428]
      - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã
           |
           +-> –ï—Å–ª–∏ –Ω–µ—Ç —Å–º–µ–Ω—ã: ‚ùå "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã"
           |
           +-> –ï—Å–ª–∏ –µ—Å—Ç—å —Å–º–µ–Ω–∞:
                    |
                    v
          –í–≤–æ–¥ —Å—É–º–º—ã (WITHDRAWAL_ENTER_AMOUNT = 18)
          –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —á–∏—Å–ª–æ
                    |
                    v
    receive_withdrawal_amount() [—Å—Ç—Ä–æ–∫–∞ 2470]
      - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç: —Å—É–º–º–∞ > 0
      - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç withdrawal_amount –≤ context
      - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                    |
                    +-> –ï—Å–ª–∏ —Å—É–º–º–∞ <= 0: ‚ùå "–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"
                    |
                    +-> –ï—Å–ª–∏ —Å—É–º–º–∞ > 0:
                             |
                             v
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (WITHDRAWAL_CONFIRM = 19)
          –ö–Ω–æ–ø–∫–∏: ‚úÖ –î–∞, —Å–Ω—è—Ç—å / ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                             |
                             v
    handle_withdrawal_confirmation() [—Å—Ç—Ä–æ–∫–∞ 2518]
      
      –ï—Å–ª–∏ "‚úÖ –î–∞, —Å–Ω—è—Ç—å":
         |
         v
      SalaryCalculator.record_cash_withdrawal() [—Å—Ç—Ä–æ–∫–∞ 384 - salary_calculator.py]
         |
         v
      INSERT INTO shift_cash_withdrawals (shift_id, admin_id, amount, reason='salary')
         |
         v
      withdrawal_id = cursor.lastrowid
         |
         v
      ‚úÖ "–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–Ω—è—Ç–∞ —Å –∫–∞—Å—Å—ã"
         üë§ {admin_name}
         üè¢ {club}
         üÜî –°–º–µ–Ω–∞: #{shift_id}
         üíµ {amount} ‚ÇΩ
         üìù –ó–∞–ø–∏—Å—å: #{withdrawal_id}
         |
         v
      –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –í–õ–ê–î–ï–õ–¨–¶–£:
         üí∞ –°–Ω—è—Ç–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã —Å –∫–∞—Å—Å—ã
         üë§ {admin_name} (ID: {user_id})
         üè¢ {club}
         üÜî {shift_id}
         üíµ {amount} ‚ÇΩ
         üìÖ {datetime}
         |
         v
      –ö–æ–Ω–µ—Ü –¥–∏–∞–ª–æ–≥–∞
      
      –ï—Å–ª–∏ "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å":
         |
         v
      ‚ùå "–°–Ω—è—Ç–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ"
      –ö–æ–Ω–µ—Ü –¥–∏–∞–ª–æ–≥–∞


3. –¢–ê–ë–õ–ò–¶–´ –ë–î
=============

shift_expenses (–¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id (PK)                         ‚îÇ
‚îÇ shift_id (FK -> active_shifts)  ‚îÇ
‚îÇ cash_source (main/box)          ‚îÇ
‚îÇ amount (REAL)                   ‚îÇ
‚îÇ reason (TEXT)                   ‚îÇ
‚îÇ created_at (TIMESTAMP)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

shift_cash_withdrawals (–¥–ª—è —Å–Ω—è—Ç–∏–π):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id (PK)                              ‚îÇ
‚îÇ shift_id (FK -> active_shifts)       ‚îÇ
‚îÇ admin_id (FK -> admins)              ‚îÇ
‚îÇ amount (REAL)                        ‚îÇ
‚îÇ reason (TEXT, default='salary')      ‚îÇ
‚îÇ created_at (TIMESTAMP)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

active_shifts (—Å–≤—è–∑–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id (PK)                              ‚îÇ
‚îÇ admin_id (INTEGER)                   ‚îÇ
‚îÇ club (TEXT)                          ‚îÇ
‚îÇ shift_type ('morning'/'evening')     ‚îÇ
‚îÇ opened_at (TIMESTAMP)                ‚îÇ
‚îÇ confirmed_by (INTEGER)               ‚îÇ
‚îÇ status ('open'/'closed')             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


4. CALLBACK –ü–ê–†–ê–ú–ï–¢–†–´
=====================

–î–ª—è —Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤:
  - shift_expense     ‚Üí –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞
  - expense_main      ‚Üí –≤—ã–±–æ—Ä –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Å—Å—ã
  - expense_box       ‚Üí –≤—ã–±–æ—Ä –∫–æ—Ä–æ–±–∫–∏
  - expense_cancel    ‚Üí –æ—Ç–º–µ–Ω–∞ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
  - expense_confirm   ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–ø–∏—Å–∞–Ω–∏—è

–î–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ª–∏—á–Ω—ã—Ö:
  - shift_salary            ‚Üí –∑–∞–ø—É—Å–∫ –¥–∏–∞–ª–æ–≥–∞
  - withdrawal_confirm      ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–Ω—è—Ç–∏—è
  - withdrawal_cancel       ‚Üí –æ—Ç–º–µ–Ω–∞ —Å–Ω—è—Ç–∏—è


5. –°–û–°–¢–û–Ø–ù–ò–Ø –î–ò–ê–õ–û–ì–ê (CONVERSATION STATES)
==========================================

EXPENSE States:
  14 (EXPENSE_SELECT_CASH_SOURCE)
    ‚Üì expense_select_cash_source()
  15 (EXPENSE_ENTER_AMOUNT)
    ‚Üì expense_receive_amount()
  16 (EXPENSE_ENTER_REASON)
    ‚Üì expense_receive_reason()
  17 (EXPENSE_CONFIRM)
    ‚Üì expense_confirm()
  END

WITHDRAWAL States:
  18 (WITHDRAWAL_ENTER_AMOUNT)
    ‚Üì receive_withdrawal_amount()
  19 (WITHDRAWAL_CONFIRM)
    ‚Üì handle_withdrawal_confirmation()
  END


6. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –í BOT
=================================

bot.py —Å—Ç—Ä–æ–∫–∞ 4768:
  expense_handler = ConversationHandler(
    entry_points=[
      CommandHandler("expense", cmd_expense),
      MessageHandler(regex="^üí∏ –°–ø–∏—Å–∞—Ç—å —Å –∫–∞—Å—Å—ã$", cmd_expense),
      CallbackQueryHandler(start_expense, pattern="^shift_expense$")
    ]
  )

bot.py —Å—Ç—Ä–æ–∫–∞ 4794:
  withdrawal_handler = ConversationHandler(
    entry_points=[
      CommandHandler("withdrawal", start_cash_withdrawal),
      MessageHandler(regex="^üí∞ –í–∑—è—Ç—å –∑–∞—Ä–ø–ª–∞—Ç—É$", start_cash_withdrawal),
      CallbackQueryHandler(start_cash_withdrawal, pattern="^shift_salary$")
    ]
  )


7. –í–ê–õ–ò–î–ê–¶–ò–Ø –î–ê–ù–ù–´–•
===================

–°—É–º–º–∞:
  ‚úì –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0
  ‚úì –§–æ—Ä–º–∞—Ç: —á–∏—Å–ª–æ (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ –∑–∞–ø—è—Ç—ã–º–∏)
  ‚úó –ï—Å–ª–∏ –Ω–µ —á–∏—Å–ª–æ: ‚ùå "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç"
  ‚úó –ï—Å–ª–∏ <= 0: ‚ùå "–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0"

–ü—Ä–∏—á–∏–Ω–∞ (–¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤):
  ‚úì –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
  ‚úó –ï—Å–ª–∏ –ø—É—Å—Ç–æ: ‚ùå "–ü—Ä–∏—á–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤"
  ‚úó –ï—Å–ª–∏ > 200: ‚ùå "–ü—Ä–∏—á–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤"

–°–º–µ–Ω–∞:
  ‚úì –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ–π (status='open')
  ‚úó –ï—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞—è/–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: ‚ùå "–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–º–µ–Ω—ã"

