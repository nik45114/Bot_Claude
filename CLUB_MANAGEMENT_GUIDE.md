# 🏢 Система управления клубами v4.10

## 📋 Что это?

Модуль для контроля за админами и клубами через бота.

**Возможности:**
- 📊 Красивые отчёты смен с автопарсингом
- 💰 Учёт финансов (наличка, безнал, QR)
- 🎮 Контроль оборудования (джойстики, компы)
- 🧻 Отслеживание расходников
- ⚠️ Сводка по проблемам
- 📈 Статистика по клубам

---

## 🚀 Установка:

```bash
cd /opt/club_assistant

# Скопируй файлы
cp club_manager.py .
cp club_commands.py .

# Перезапусти
systemctl restart club_assistant
```

**Всё! Модули уже интегрированы в бота.**

---

## 📖 КОМАНДЫ:

### /clubs - Главное меню

Показывает все команды управления клубами

---

### /clubadd - Добавить клуб

```
/clubadd <название> [адрес]

Примеры:
/clubadd Центральный
/clubadd Северный Ленина 123
```

---

### /clublist - Список клубов

```
/clublist

Показывает:
🔹 Центральный
   📍 Ленина 123
   
🔹 Северный
   📍 Пушкина 45
```

---

### /report - Отчёт смены (ГЛАВНАЯ ФУНКЦИЯ!)

```
/report <клуб>

Пример:
/report Центральный

→ Бот попросит отправить отчёт
→ Отправляешь текст (любой формат!)
→ Бот парсит и сохраняет
```

**Админ отправляет:**
```
Вечер 15.10
Факт нал 3 940 / 20 703
Наличка в сейфе 927
Факт бн 16 327
QR 3 753
Безнал новая касса 400
Наличка monster/red bull 1 500
Факт нал в коробке 4 424
Количество джойстиков 15
3 в ремонте
3 требуется ремонт
Игр 30
Туалетка есть
Бумажные полотенца нет
```

**Бот возвращает:**
```
╔═══════════════════════════════
║ 🌆 Отчёт смены
╠═══════════════════════════════
║ 🏢 Клуб: Центральный
║ 📅 Дата: 2025-10-15
║ 👤 Админ: Иван Иванов
╚═══════════════════════════════

💰 ФИНАНСЫ
━━━━━━━━━━━━━━━━━━━━━━━━━━━
💵 Наличные:
   Факт:        3,940 ₽
   План:       20,703 ₽
   📉 Разница: -16,763 ₽

   Сейф:          927 ₽
   Коробка:     4,424 ₽

💳 Безнал:
   Факт:       16,327 ₽
   QR:          3,753 ₽
   Новая:         400 ₽

🛒 Товары:       1,500 ₽

🎮 ОБОРУДОВАНИЕ
━━━━━━━━━━━━━━━━━━━━━━━━━━━
🕹 Джойстики:
   Всего:          15
   ✅ Работают:     9 (60%)
   🔧 В ремонте:    3
   ⚠️ Требует:      3

💻 Компьютеры:     30

🧻 РАСХОДНИКИ
━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Туалетка: есть
❌ Бумажные полотенца: нет

━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 Отчёт #123
```

**Красиво и наглядно!** ✨

---

### /lastreport - Последний отчёт

```
/lastreport <клуб>

Пример:
/lastreport Центральный

→ Показывает последний отчёт
```

---

### /clubstats - Статистика клуба

```
/clubstats <клуб> [дней]

Примеры:
/clubstats Центральный
/clubstats Центральный 30
```

**Показывает:**
```
📊 Статистика - Центральный
За последние 7 дней

━━━━━━━━━━━━━━━━━━━━━━━━━━━
💰 ВЫРУЧКА
━━━━━━━━━━━━━━━━━━━━━━━━━━━
💵 Наличные:     127,580 ₽
💳 Безнал:        89,320 ₽
📱 QR:            23,100 ₽
━━━━━━━━━━━━━━━━━━━━━━━━━━━
💰 ИТОГО:        240,000 ₽

📈 Смен: 21
📊 Средний чек:   11,428 ₽

⚠️ Открытых проблем: 3
```

---

### /issues - Сводка по проблемам

```
/issues [клуб]

Примеры:
/issues                  # все проблемы
/issues Центральный      # только этот клуб
```

**Показывает:**
```
⚠️ ОТКРЫТЫЕ ПРОБЛЕМЫ
━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 🏢 Центральный
   Джойстик #5 сломан, не реагирует
   👤 Иван Иванов • 📅 2025-10-15

2. 🏢 Северный
   Нет бумажных полотенец
   👤 Пётр Петров • 📅 2025-10-14

3. 🏢 Центральный
   Компьютер #12 перегревается
   👤 Иван Иванов • 📅 2025-10-13
```

---

## 🎯 АВТОПАРСИНГ ОТЧЁТОВ:

Бот понимает любой формат! Примеры:

### Вариант 1: Как в примере
```
Вечер 15.10
Факт нал 3 940 / 20 703
Наличка в сейфе 927
```

### Вариант 2: Свободный формат
```
Вечерняя смена 15 октября
Наличные факт: 3940
План был: 20703
В сейфе: 927
```

### Вариант 3: Краткий
```
Вечер 15.10
Нал: 3940/20703
Сейф: 927
БН: 16327
```

**Бот парсит всё!**

---

## 📊 ЧТО ПАРСИТСЯ:

### 💰 Финансы:
- Факт нал / План нал
- Наличка в сейфе
- Факт безнал
- QR платежи
- Безнал новая касса
- Наличка товары (monster, red bull, рули, одноразки)
- Факт нал в коробке

### 🎮 Оборудование:
- Количество джойстиков
- В ремонте
- Требуется ремонт
- Игровые компьютеры

### 🧻 Расходники:
- Туалетка (есть/нет)
- Бумажные полотенца (есть/нет)
- Любые другие (автоопределение)

### ⚠️ Проблемы:
Если в тексте есть слова:
- "проблема"
- "сломан"
- "не работает"
- "требуется"

Автоматически сохраняется в проблемы!

---

## 🔄 WORKFLOW:

### 1. Добавляешь клубы (один раз):
```
/clubadd Центральный Ленина 123
/clubadd Северный Пушкина 45
```

### 2. Админы сдают отчёты после смены:
```
Админ: /report Центральный

Бот: 📋 Отчёт смены - Центральный
Отправь отчёт в любом формате.

Админ: [отправляет текст]

Бот: [красивый отчёт]
```

### 3. Ты смотришь статистику:
```
/clubstats Центральный
/clubstats Северный
/issues
```

---

## 💡 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:

### Ежедневный контроль:

```
Утром:
/issues                    # проверяешь проблемы

Вечером:
/lastreport Центральный    # смотришь последний отчёт
/lastreport Северный
```

### Еженедельная статистика:

```
/clubstats Центральный 7
/clubstats Северный 7
```

### Месячный отчёт:

```
/clubstats Центральный 30
/clubstats Северный 30
```

---

## ⚙️ ИНТЕГРАЦИЯ С V2RAY:

Оба модуля работают независимо:

```
# Управление клубами
/clubs
/report Центральный
/clubstats Центральный

# Управление прокси
/v2ray
/v2add main 1.2.3.4 root pass
/v2user main @user
```

**Не мешают друг другу!**

---

## 🔒 БЕЗОПАСНОСТЬ:

- Только **owner_id** имеет доступ
- Админы могут только сдавать отчёты
- Все данные в зашифрованной базе
- История всех отчётов сохраняется

---

## 📊 БАЗА ДАННЫХ:

Автоматически создаются таблицы:
- `clubs` - клубы
- `shifts` - смены
- `shift_finance` - финансы
- `shift_equipment` - оборудование
- `shift_supplies` - расходники
- `shift_issues` - проблемы

**Всё в одной базе `knowledge.db`**

---

## 🎨 КАСТОМИЗАЦИЯ:

### Добавить новый расходник:

Просто упомяни в отчёте:
```
Салфетки есть
Мыло нет
```

Бот автоматически распарсит!

### Добавить новую проблему:

Просто напиши:
```
Проблема: компьютер #5 тормозит
```

Автоматически добавится в /issues!

---

## 🐛 TROUBLESHOOTING:

### Бот не парсит отчёт:

**Проверь:**
- Минимум 5 строк текста
- Есть цифры (финансы)
- Упомянут тип смены (Утро/День/Вечер/Ночь)

### Не сохраняется отчёт:

```
/report Центральный

→ Если ошибка:
1. Проверь что клуб добавлен: /clublist
2. Проверь формат текста
```

---

## ✅ ИТОГ:

**Система управления клубами** - полный контроль через бота:

✅ Красивые отчёты с автопарсингом  
✅ Финансы, оборудование, расходники  
✅ Сводка по проблемам  
✅ Статистика по клубам  
✅ История всех смен  
✅ Доступ только владельцу  

**Админы сдают отчёты - ты контролируешь всё!** 🚀

---

## 🎯 БЫСТРЫЙ СТАРТ:

```bash
# 1. Скопируй файлы
cd /opt/club_assistant
cp club_manager.py .
cp club_commands.py .
systemctl restart club_assistant

# 2. Добавь клубы
/clubadd Центральный Ленина 123
/clubadd Северный Пушкина 45

# 3. Админы сдают отчёты
/report Центральный
→ [текст отчёта]

# 4. Смотри статистику
/clubstats Центральный
/issues
```

**Готово!** 🎉
