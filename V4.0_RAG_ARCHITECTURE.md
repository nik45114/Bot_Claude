# Club Assistant Bot v4.0 - RAG Architecture

## üéØ –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### ‚ùå –°—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (v3.x):
```
–í–æ–ø—Ä–æ—Å ‚Üí SequenceMatcher –ø–æ–∏—Å–∫ ‚Üí score –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
       ‚Üí –µ—Å–ª–∏ score > 200: –æ—Ç–≤–µ—Ç –∏–∑ –ë–î
       ‚Üí –∏–Ω–∞—á–µ: GPT –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
       ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—é–±–æ–≥–æ GPT-–æ—Ç–≤–µ—Ç–∞ –≤ –ë–î
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä–æ–≥–∏ (score > 200)
- –ü–ª–æ—Ö–æ–π –ø–æ–∏—Å–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
- –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ GPT
- –ú—É—Å–æ—Ä –≤ –±–∞–∑–µ

### ‚úÖ –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (v4.0):
```
–í–æ–ø—Ä–æ—Å ‚Üí Embedding ‚Üí Vector Search (FAISS)
       ‚Üí Top-5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
       ‚Üí RAG: GPT —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º + —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ [ID]
       ‚Üí –ï—Å–ª–∏ confidence < 0.7: –≤ Draft Queue
       ‚Üí –ê–¥–º–∏–Ω —Ä–µ–≤—å—é: ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å / ‚úèÔ∏è –ü—Ä–∞–≤–∏—Ç—å / üóë –£–¥–∞–ª–∏—Ç—å
       ‚Üí –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è: –≤ KB + Vector Index
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (–ø–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª)
- –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞
- –ù–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### 1. –î–≤—É—Ö—Å–ª–æ–π–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

#### Metadata –ë–î (SQLite):
```sql
knowledge:
  - id, question, answer, category, tags, source
  - version, is_current, created_at, added_by
  
knowledge_drafts:
  - id, question, answer, category, tags
  - confidence, status (pending/approved/rejected)
  - added_by, reviewed_by, reviewed_at
```

#### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å (FAISS):
```python
VectorStore:
  - FAISS Index (1536D vectors)
  - id_map: vector_id ‚Üí kb_id
  - metadata: kb_id ‚Üí {category, tags, ...}
  
–ú–µ—Ç–æ–¥—ã:
  - upsert(kb_id, vector, metadata)
  - search(query_vector, top_k=5) ‚Üí results
  - reindex(items) # –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
```

### 2. –ú–æ–¥—É–ª–∏

#### `embeddings.py`:
```python
EmbeddingService:
  - embed(text) ‚Üí vector[1536]
  - embed_batch(texts) ‚Üí List[vector]
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (MD5 ‚Üí .json)
  - OpenAI text-embedding-3-small
```

#### `vector_store.py`:
```python
VectorStore:
  - FAISS IndexFlatIP (–∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ)
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
  - kNN –ø–æ–∏—Å–∫
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
```

#### `draft_queue.py`:
```python
DraftQueue:
  - add_draft(q, a, confidence)
  - get_pending() ‚Üí drafts
  - approve(draft_id) ‚Üí –≤ KB
  - reject(draft_id)
  - update_draft() # —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üîÑ Workflow v4.0:

### –ü–æ–∏—Å–∫ –∏ –æ—Ç–≤–µ—Ç:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–∫–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –±–∏–æ—Å"

2. Embedding: 
   query_vec = embed("–∫–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –±–∏–æ—Å")

3. Vector Search:
   results = vector_store.search(query_vec, top_k=5)
   # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å score (–∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ 0-1)

4. RAG-–∫–æ–º–ø–æ–Ω–æ–≤–∫–∞:
   context = "\n\n".join([
     f"[{r.kb_id}] Q: {r.question}\nA: {r.answer}"
     for r in results
   ])

5. GPT —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
   prompt = f"""–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–ª—É–±–∞. 
   –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
   –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
   –í –∫–æ–Ω—Ü–µ –¥–∞–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ [ID].
   
   –í–æ–ø—Ä–æ—Å: {user_q}
   
   –ö–æ–Ω—Ç–µ–∫—Å—Ç:
   {context}
   """
   
   answer = gpt.chat(prompt)

6. –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
   "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª BIOS –Ω–∞ USB-—Ñ–ª–µ—à–∫—É...
   
   –ò—Å—Ç–æ—á–Ω–∏–∫–∏: [123], [98]"

7. –ï—Å–ª–∏ confidence < 0.7:
   # –ù–µ —É–≤–µ—Ä–µ–Ω—ã - –¥–æ–±–∞–≤–ª—è–µ–º –≤ drafts
   draft_queue.add_draft(
     question=normalized_q,
     answer=answer,
     confidence=calc_confidence(results),
     status='pending'
   )
```

### –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –æ–±—É—á–µ–Ω–∏–µ:

```
1. –ê–¥–º–∏–Ω: /review

2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫:
   
   üìù –ß–µ—Ä–Ω–æ–≤–∏–∫ #42
   Confidence: 0.65
   
   ‚ùì –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å CLS?
   üí¨ CLS –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å...
   
   üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: software
   üè∑ –¢–µ–≥–∏: cls,–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   
   [‚úÖ –û–¥–æ–±—Ä–∏—Ç—å] [‚úèÔ∏è –ü—Ä–∞–≤–∏—Ç—å] [üóë –£–¥–∞–ª–∏—Ç—å]

3. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç [‚úèÔ∏è –ü—Ä–∞–≤–∏—Ç—å]:
   
   –ß—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º?
   [üìù –í–æ–ø—Ä–æ—Å] [üí¨ –û—Ç–≤–µ—Ç] [üè∑ –¢–µ–≥–∏]

4. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç [‚úÖ –û–¥–æ–±—Ä–∏—Ç—å]:
   
   # –î–æ–±–∞–≤–ª—è–µ–º –≤ KB
   kb.add(question, answer, category, tags, added_by)
   
   # –°–æ–∑–¥–∞—ë–º —ç–º–±–µ–¥–¥–∏–Ω–≥
   vec = embed(f"{question}\n\n{answer}")
   
   # –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å
   vector_store.upsert(kb_id, vec, metadata)
   
   # –ü–æ–º–µ—á–∞–µ–º draft –∫–∞–∫ approved
   draft_queue.approve(draft_id, reviewed_by)
   
   ‚úÖ –ó–Ω–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–∞–∑—É!
```

---

## üìä –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö v4.0:

### –¢–∞–±–ª–∏—Ü–∞ `knowledge` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):
```sql
CREATE TABLE knowledge (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    category TEXT DEFAULT 'general',
    tags TEXT DEFAULT '',
    source TEXT DEFAULT '',
    added_by INTEGER,
    version INTEGER DEFAULT 1,
    is_current BOOLEAN DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### –¢–∞–±–ª–∏—Ü–∞ `knowledge_drafts` (–ù–û–í–ê–Ø):
```sql
CREATE TABLE knowledge_drafts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    category TEXT DEFAULT 'general',
    tags TEXT DEFAULT '',
    source TEXT DEFAULT '',
    confidence REAL DEFAULT 0.5,  -- 0.0-1.0
    added_by INTEGER,
    reviewed_by INTEGER,
    status TEXT DEFAULT 'pending', -- pending/approved/rejected
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    reviewed_at TIMESTAMP
);
```

### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å (FAISS):
```
vector_index.faiss:
  - –ë–∏–Ω–∞—Ä–Ω—ã–π FAISS –∏–Ω–¥–µ–∫—Å
  - IndexFlatIP (Inner Product)
  - Dimension: 1536

vector_metadata.pkl:
  - id_map: [kb_id_1, kb_id_2, ...]
  - metadata: {kb_id: {category, tags, ...}}
```

### –ö—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:
```
.embedding_cache/
  - <md5_hash>.json  # vector[1536]
```

---

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è —Å v3.x –Ω–∞ v4.0:

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /opt/club_assistant

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º FAISS
pip install faiss-cpu numpy --break-system-packages

# –ò–ª–∏ GPU –≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å CUDA):
# pip install faiss-gpu
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

```bash
# –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã:
# - embeddings.py
# - vector_store.py
# - draft_queue.py

chmod +x embeddings.py vector_store.py draft_queue.py
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
python3 migrate_to_v4.py

# –ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:
# 1. –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É knowledge_drafts
# 2. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ knowledge
# 3. –°–æ–∑–¥–∞—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–±–∞—Ç—á–∞–º–∏ –ø–æ 100)
# 4. –°—Ç—Ä–æ–∏—Ç FAISS –∏–Ω–¥–µ–∫—Å
# 5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ –¥–∏—Å–∫
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

```bash
# –°–∫–∞—á–∏–≤–∞–µ–º bot_v4.py
# –ó–∞–º–µ–Ω—è–µ–º bot.py

systemctl restart club_assistant
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

### –ë—ã–ª–æ (v3.x):
```python
# –ü–æ–∏—Å–∫
answer = kb.find(question)
if answer:
    return answer

# –£–º–Ω—ã–π –ø–æ–∏—Å–∫
results = kb.smart_search(question)
if results[0]['score'] >= 200:
    return results[0]['answer']

# GPT
gpt_answer = gpt.ask(question)
kb.add(question, gpt_answer)  # –°—Ä–∞–∑—É –≤ –±–∞–∑—É!
return gpt_answer
```

### –°—Ç–∞–ª–æ (v4.0):
```python
# 1. Embedding
query_vec = embedding_service.embed(question)

# 2. Vector Search
results = vector_store.search(query_vec, top_k=5)

# 3. RAG
if results:
    # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    context = build_context(results)
    
    # GPT —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    answer = gpt.rag_answer(question, context)
    
    # Confidence
    conf = calculate_confidence(results, answer)
    
    if conf < 0.7:
        # –í –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Ä–µ–≤—å—é
        draft_queue.add_draft(
            question, answer,
            confidence=conf,
            status='pending'
        )
        
        # –ù–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º
        answer += "\n\n‚ö†Ô∏è –û—Ç–≤–µ—Ç —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏"
    
    return answer
else:
    # –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - —á–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä–∏–º
    return "–ù–µ –Ω–∞—à—ë–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –£—Ç–æ—á–Ω–∏ –≤–æ–ø—Ä–æ—Å?"
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ v4.0:

### 1. –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞:

| –ú–µ—Ç–æ–¥ | v3.x | v4.0 |
|-------|------|------|
| "–∫–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –±–∏–æ—Å" | score: 24 | similarity: 0.92 |
| "–∞–ø–¥–µ–π—Ç bios" | –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç | similarity: 0.88 |
| "–ø—Ä–æ—à–∏–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–Ω–∫–∏" | score: 60 | similarity: 0.85 |

### 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å:

**v3.x:**
```
–ë–æ—Ç: –û–±–Ω–æ–≤–∏—Ç–µ BIOS —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É...
```
–û—Ç–∫—É–¥–∞ –∏–Ω—Ñ–∞? –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è?

**v4.0:**
```
–ë–æ—Ç: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª BIOS –Ω–∞ USB-—Ñ–ª–µ—à–∫—É...

–ò—Å—Ç–æ—á–Ω–∏–∫–∏: [123], [98]
```
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å!

### 3. –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞:

**v3.x:**
- –õ—é–±–æ–π GPT-–æ—Ç–≤–µ—Ç ‚Üí —Å—Ä–∞–∑—É –≤ –±–∞–∑—É
- –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –º—É—Å–æ—Ä
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

**v4.0:**
- Low confidence ‚Üí –≤ drafts
- –ê–¥–º–∏–Ω —Ä–µ–≤—å—é
- –¢–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –≤ –±–∞–∑–µ

### 4. –≠–∫–æ–Ω–æ–º–∏—è:

- **–ö—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã
- **–ú–µ–Ω—å—à–µ GPT-–∑–∞–ø—Ä–æ—Å–æ–≤**: —Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ fallback –Ω–∞ GPT
- **Batch embedding**: –¥–µ—à–µ–≤–ª–µ —á–µ–º –ø–æ –æ–¥–Ω–æ–º—É

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è v4.0:

### `config.json`:
```json
{
  "telegram_token": "...",
  "openai_api_key": "...",
  "admin_ids": [123456789],
  "github_repo": "...",
  "gpt_model": "gpt-4o-mini",
  "embedding_model": "text-embedding-3-small",
  "vector_search": {
    "top_k": 5,
    "min_score": 0.5
  },
  "draft_queue": {
    "confidence_threshold": 0.7,
    "auto_approve_threshold": 0.9
  }
}
```

---

## üõ†Ô∏è –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤:

```
/review - –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Ä–µ–≤—å—é
/reindex - –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤
/vectorstats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
/draftstats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
/teach <question> <answer> - –¥–æ–±–∞–≤–∏—Ç—å –≤ drafts
```

### API (–Ω–æ–≤–æ–µ):

```bash
# POST /teach
curl -X POST http://localhost:5000/teach \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "–ì–¥–µ –∫–ª—É–±?",
    "answer": "–ù–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞ 123",
    "category": "service",
    "tags": "–∞–¥—Ä–µ—Å,–∫–ª—É–±,–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
  }'

# –û—Ç–≤–µ—Ç:
{
  "success": true,
  "draft_id": 42,
  "status": "pending_review"
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ v4.0:

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```python
metrics = {
    'total_queries': 1532,
    'vector_hits': 1289,    # –ù–∞—à–ª–∏ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ
    'avg_similarity': 0.78,
    'drafts_pending': 12,
    'drafts_approved': 234,
    'drafts_rejected': 56,
    'embedding_cache_hit_rate': 0.85,
    'avg_response_time_ms': 120
}
```

### –ö–∞—á–µ—Å—Ç–≤–æ:

```python
quality = {
    'avg_confidence': 0.82,
    'low_confidence_rate': 0.08,  # 8% –≤ drafts
    'user_satisfaction': 0.91,    # –ü–æ feedback
    'false_positive_rate': 0.03
}
```

---

## üéâ –ò—Ç–æ–≥ v4.0:

‚úÖ **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** - –ø–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª  
‚úÖ **RAG —Å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞** - drafts + review  
‚úÖ **–ù–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π** - —Ç–æ–ª—å–∫–æ –∏–∑ –±–∞–∑—ã  
‚úÖ **API –¥–ª—è –æ–±—É—á–µ–Ω–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è  
‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —ç–∫–æ–Ω–æ–º–∏—è  
‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  

**–≠—Ç–æ production-ready —Ä–µ—à–µ–Ω–∏–µ!** üöÄ

---

## üìù Checklist –º–∏–≥—Ä–∞—Ü–∏–∏:

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å FAISS (`pip install faiss-cpu`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª–∏ (embeddings.py, vector_store.py, draft_queue.py)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É knowledge_drafts
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é (`migrate_to_v4.py`)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å bot.py –¥–æ v4.0
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–µ–≤—å—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏: —Å–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π bot_v4.py**
